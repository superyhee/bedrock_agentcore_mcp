# 对话场景使用指南

本文档介绍如何使用预置的对话场景来测试和演示 AgentCore Baidu Map Agent 的能力。

## 概述

我们提供了 **15 个精心设计的对话场景**，涵盖日常生活的各个方面。每个场景包含 5-7 个连续的问题，展示 Agent 的上下文理解和多轮对话能力。

## 场景列表

### 1. 基础场景

**用途**: 用户信息收集和个性化推荐

**对话流程**:

```
用户: 我住在北京，我的爱好是出门赏花，我喜欢吃海鲜
Agent: [记录用户信息]

用户: 帮我根据我的爱好规划一个一天游玩的规划
Agent: [基于用户偏好提供个性化建议]

用户: 帮我查看这条路线的目前的交通状况？
Agent: [理解"这条路线"指代上一个回答中的路线]
```

**测试能力**:

- ✅ 用户信息记忆
- ✅ 个性化推荐
- ✅ 路线规划
- ✅ 指代消解

---

### 2. 旅游规划

**用途**: 多城市旅游规划和景点推荐

**对话流程**:

```
用户: 我下周要去上海旅游，帮我推荐一些必去的景点
用户: 外滩怎么去？
用户: 那里附近有什么好吃的餐厅？
用户: 从外滩到东方明珠怎么走？
```

**测试能力**:

- ✅ 景点推荐
- ✅ 路线导航
- ✅ 地点指代（"那里"、"外滩"）
- ✅ 美食推荐

---

### 3. 本地生活

**用途**: 本地服务查询（健身房、咖啡店等）

**对话流程**:

```
用户: 我在北京朝阳区，想找个附近的健身房
用户: 哪家评分最高？
用户: 那家健身房的营业时间是什么？
用户: 从我这里怎么过去？
```

**测试能力**:

- ✅ POI 搜索
- ✅ 评分排序
- ✅ 营业信息查询
- ✅ 路线规划

---

### 4. 美食探索

**用途**: 餐厅搜索和美食推荐

**对话流程**:

```
用户: 我想吃火锅，帮我找找北京三里屯附近的火锅店
用户: 哪家最受欢迎？
用户: 那家店的人均消费是多少？
用户: 需要提前预约吗？
```

**测试能力**:

- ✅ 餐厅搜索
- ✅ 热度排序
- ✅ 价格查询
- ✅ 预订信息

---

### 5. 通勤路线

**用途**: 上下班路线规划和优化

**对话流程**:

```
用户: 我住在北京回龙观，公司在国贸，帮我规划一下上班路线
用户: 早高峰大概需要多久？
用户: 有没有更快的路线？
用户: 如果坐地铁呢？
用户: 地铁和开车哪个更快？
```

**测试能力**:

- ✅ 多种交通方式规划
- ✅ 时间估算
- ✅ 路线对比
- ✅ 实时路况

---

### 6. 周末活动

**用途**: 家庭周末活动规划

**对话流程**:

```
用户: 这个周末想带孩子出去玩，北京有什么适合亲子的地方？
用户: 动物园怎么样？
用户: 从西二旗怎么去动物园？
用户: 门票多少钱？
```

**测试能力**:

- ✅ 亲子场所推荐
- ✅ 路线规划
- ✅ 门票信息
- ✅ 周边配套

---

### 7. 购物场景

**用途**: 购物中心导航和推荐

**对话流程**:

```
用户: 我想去买衣服，北京有哪些大型购物中心？
用户: 三里屯太古里怎么样？
用户: 那里有什么品牌？
用户: 从中关村怎么去？
```

**测试能力**:

- ✅ 购物中心推荐
- ✅ 品牌信息
- ✅ 路线导航
- ✅ 停车信息

---

### 8. 紧急情况

**用途**: 紧急情况下的快速查询

**对话流程**:

```
用户: 我在北京西单，突然肚子疼，附近有医院吗？
用户: 最近的是哪家？
用户: 怎么去？
用户: 打车大概多久能到？
```

**测试能力**:

- ✅ 紧急设施查询
- ✅ 距离排序
- ✅ 快速路线
- ✅ 时间估算

---

### 9. 酒店预订

**用途**: 出差/旅游酒店查询

**对话流程**:

```
用户: 我要去杭州出差，帮我找西湖附近的酒店
用户: 哪家性价比最高？
用户: 那家酒店离西湖有多远？
用户: 从杭州东站怎么去酒店？
```

**测试能力**:

- ✅ 酒店搜索
- ✅ 性价比分析
- ✅ 距离计算
- ✅ 交通规划

---

### 10. 城市对比

**用途**: 多城市对比和选择

**对话流程**:

```
用户: 我想在国庆去旅游，北京、上海、成都哪个更适合？
用户: 成都有什么特色美食？
用户: 成都的天气怎么样？
用户: 从北京飞成都要多久？
```

**测试能力**:

- ✅ 多城市对比
- ✅ 特色推荐
- ✅ 天气查询
- ✅ 交通信息

---

### 11. 文化活动

**用途**: 文化场馆和活动查询

**对话流程**:

```
用户: 北京最近有什么展览或者演出吗？
用户: 国家博物馆现在有什么展？
用户: 怎么预约？
用户: 从五道口怎么去？
```

**测试能力**:

- ✅ 活动搜索
- ✅ 展览信息
- ✅ 预约指南
- ✅ 路线导航

---

### 12. 运动健身

**用途**: 运动场所和路线推荐

**对话流程**:

```
用户: 我想去跑步，北京有什么好的跑步路线？
用户: 奥林匹克森林公园怎么样？
用户: 那里有多大？跑一圈多远？
用户: 从望京怎么去？
```

**测试能力**:

- ✅ 运动场所推荐
- ✅ 场地信息
- ✅ 距离计算
- ✅ 路线规划

---

### 13. 学习教育

**用途**: 教育机构和学习场所查询

**对话流程**:

```
用户: 我想学英语，北京有什么好的英语培训机构？
用户: 新东方怎么样？
用户: 中关村有校区吗？
用户: 从清华大学怎么去？
```

**测试能力**:

- ✅ 教育机构搜索
- ✅ 校区查询
- ✅ 路线规划
- ✅ 周边设施

---

### 14. 宠物相关

**用途**: 宠物友好场所和服务

**对话流程**:

```
用户: 我养了一只狗，北京有什么宠物友好的公园？
用户: 朝阳公园可以带狗吗？
用户: 从亦庄怎么去？
用户: 附近有宠物医院吗？
```

**测试能力**:

- ✅ 宠物友好场所
- ✅ 政策查询
- ✅ 路线规划
- ✅ 宠物服务

---

### 15. 夜生活

**用途**: 夜间娱乐和餐饮推荐

**对话流程**:

```
用户: 北京晚上有什么好玩的地方？
用户: 三里屯酒吧街怎么样？
用户: 那里有什么特色酒吧？
用户: 从CBD怎么去？
```

**测试能力**:

- ✅ 夜间场所推荐
- ✅ 特色查询
- ✅ 路线规划
- ✅ 交通便利性

---

## 使用方法

### 方法 1: 使用 Boto3 客户端

```bash
# 运行交互式场景选择
python clients/boto3_client.py

# 运行自定义问题
python clients/boto3_client.py "你的问题"
```

**交互式菜单**:

```
可用的对话场景:
--------------------------------------------------------------------------------
 1. 基础场景     - 6 个问题
 2. 旅游规划     - 7 个问题
 3. 本地生活     - 7 个问题
 4. 美食探索     - 7 个问题
 5. 通勤路线     - 7 个问题
 6. 周末活动     - 7 个问题
 7. 购物场景     - 7 个问题
 8. 紧急情况     - 7 个问题
 9. 酒店预订     - 7 个问题
10. 城市对比     - 7 个问题
11. 文化活动     - 7 个问题
12. 运动健身     - 7 个问题
13. 学习教育     - 7 个问题
14. 宠物相关     - 7 个问题
15. 夜生活       - 7 个问题
16. 全部场景     - 运行所有场景
--------------------------------------------------------------------------------

请选择场景编号 (直接回车运行基础场景):
```

### 方法 2: 使用测试脚本

```bash
# 运行测试菜单
python tests/test_conversation_scenarios.py

# 测试指定场景
python tests/test_conversation_scenarios.py "旅游规划"
```

**测试菜单**:

```
对话场景测试工具
================================================================================
1. 测试上下文理解能力
2. 测试个性化推荐能力
3. 测试单个场景
4. 运行所有测试
================================================================================

请选择 (1-4):
```

### 方法 3: 使用 AgentCore CLI

```bash
# 使用相同的 session-id 进行多轮对话
SESSION_ID="my_conversation_$(date +%s)"

# 第一个问题
agentcore invoke '{"prompt": "我住在北京，我的爱好是出门赏花"}' \
  --session-id $SESSION_ID

# 第二个问题（Agent 会记住上下文）
agentcore invoke '{"prompt": "帮我推荐一些适合赏花的地方"}' \
  --session-id $SESSION_ID

# 第三个问题（继续使用上下文）
agentcore invoke '{"prompt": "那里怎么去？"}' \
  --session-id $SESSION_ID
```

## 测试上下文理解

### 地点指代测试

```python
# 问题 1: 建立地点上下文
"帮我搜索北京的景点"

# 问题 2: 使用"那里"指代北京
"那里的天气怎么样？"

# 问题 3: 使用"那个城市"指代北京
"从上海到那个城市怎么走？"
```

**预期结果**: Agent 应该理解"那里"和"那个城市"都指代"北京"

### 路线指代测试

```python
# 问题 1: 建立路线上下文
"从天安门到故宫怎么走？"

# 问题 2: 使用"这条路线"指代
"这条路线需要多长时间？"

# 问题 3: 继续讨论同一路线
"有更快的方式吗？"
```

**预期结果**: Agent 应该理解所有问题都在讨论同一条路线

### 事物指代测试

```python
# 问题 1: 建立事物上下文
"搜索一下 AWS Lambda 的信息"

# 问题 2: 使用"它"指代 Lambda
"它支持哪些编程语言？"

# 问题 3: 继续讨论 Lambda
"价格怎么样？"
```

**预期结果**: Agent 应该理解"它"指代"AWS Lambda"

## 测试个性化推荐

```python
# 步骤 1: 收集用户偏好
"我喜欢吃辣的，不喜欢甜食"
"我住在北京朝阳区"
"我的预算是人均100元左右"

# 步骤 2: 请求推荐
"根据我的喜好，推荐几家餐厅"

# 预期: Agent 应该推荐：
# - 辣味餐厅
# - 位于朝阳区或附近
# - 人均100元左右

# 步骤 3: 继续对话
"如果我想吃火锅呢？"

# 预期: Agent 应该继续考虑用户的偏好和预算
```

## 性能指标

### 响应时间

- 首次响应: < 2 秒
- 流式输出: 实时（< 100ms 延迟）
- 上下文检索: < 150ms

### 准确率

- 指代消解准确率: > 90%
- 路线规划准确率: > 95%
- POI 搜索准确率: > 95%

### 用户体验

- 流式输出: ✅ 实时反馈
- 上下文理解: ✅ 多轮对话
- 个性化: ✅ 记住用户偏好

## 最佳实践

### 1. 使用有意义的 Session ID

```python
# ✅ 好的做法
session_id = f"user_{user_id}_travel_{date}"

# ❌ 避免
session_id = "abc123"
```

### 2. 保持对话连贯性

```python
# ✅ 好的做法：使用相同的 session_id
for question in questions:
    invoke_agent(question, session_id=same_session_id)

# ❌ 避免：每次使用新的 session_id
for question in questions:
    invoke_agent(question, session_id=new_session_id())
```

### 3. 合理使用对话历史

```python
# ✅ 需要上下文的对话
payload = {"prompt": "那里怎么样？", "use_history": True}

# ✅ 独立查询可以禁用以提高性能
payload = {"prompt": "今天日期是多少？", "use_history": False}
```

### 4. 测试边界情况

```python
# 测试长对话
# 测试模糊指代
# 测试多个地点切换
# 测试复杂路线规划
```

## 故障排查

### 问题 1: Agent 无法理解上下文

**症状**: Agent 不理解"那里"、"这个"等指代

**可能原因**:

- Session ID 不一致
- 对话历史未启用
- Memory 配置错误

**解决方案**:

```bash
# 检查 session ID
echo $SESSION_ID

# 确认启用历史
payload = {"prompt": "...", "use_history": True}

# 检查 Memory 配置
agentcore configure --check
```

### 问题 2: 响应速度慢

**症状**: 响应时间 > 5 秒

**可能原因**:

- 对话历史过长
- 网络延迟
- 工具调用过多

**解决方案**:

```python
# 减少历史轮数
max_turns = 5  # 从 10 减少到 5

# 禁用不必要的历史
payload = {"prompt": "...", "use_history": False}
```

### 问题 3: 流式输出中断

**症状**: 流式输出突然停止

**可能原因**:

- 网络连接问题
- 超时设置
- 响应过大

**解决方案**:

```python
# 增加超时时间
response = agent_core_client.invoke_agent_runtime(
    ...,
    timeout=300  # 5 分钟
)

# 检查网络连接
# 查看 CloudWatch Logs
```

## 扩展场景

你可以轻松添加自己的场景：

```python
# 在 clients/boto3_client.py 中添加

# 场景16: 你的自定义场景
your_custom_scenario = [
    "第一个问题",
    "第二个问题",
    "第三个问题",
    # ...
]

# 添加到场景集合
all_scenarios["你的场景名"] = your_custom_scenario
```

## 下一步

- 查看 [MEMORY_GUIDE.md](./MEMORY_GUIDE.md) 了解记忆功能
- 查看 [TESTING_GUIDE.md](./TESTING_GUIDE.md) 了解测试方法
- 查看 [README_AGENTCORE.md](./README_AGENTCORE.md) 了解部署

## 参考资料

- [AgentCore 文档](https://aws.github.io/bedrock-agentcore-starter-toolkit/)
- [Strands Agent 文档](https://strands.ai/docs)
- [百度地图 API](https://lbsyun.baidu.com/)
