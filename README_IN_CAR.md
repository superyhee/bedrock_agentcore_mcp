# 🚗 智能座舱 Agent - 对话场景测试

基于 AgentCore 和百度地图的智能座舱对话 Agent，专为车载场景优化。

## 🎯 特性

- ✅ **16 个精选场景** - 1 个基础场景 + 15 个智能座舱专属场景
- ✅ **优先级分级** - P0/P1/P2/P3 四级优先级
- ✅ **流式输出** - 实时响应，低延迟
- ✅ **上下文理解** - 多轮对话，理解指代关系
- ✅ **语音优先** - 适合车载语音交互

## 📋 场景列表

### 基础场景 (1 个)

- **基础场景** - 用户信息收集和个性化推荐

### 🚗 智能座舱专属场景 (15 个)

#### P0 级 - 核心功能 (2 个)

1. **🚗 智能导航** - 实时导航和路线规划
2. **🚗 实时路况** - 路况查询和智能避堵

#### P1 级 - 高频刚需 (3 个)

3. **🚗 沿途服务** - 沿途餐厅、加油站等服务
4. **🚗 停车场景** - 停车场查询和导航
5. **🚗 充电加油** - 加油站/充电桩查询

#### P2 级 - 日常高频 (4 个)

6. **🚗 接送人** - 机场/车站接送场景
7. **🚗 自驾游** - 周末自驾游规划
8. **🚗 多目的地** - 多点路线优化
9. **🚗 语音控制** - 语音交互场景

#### P3 级 - 辅助功能 (6 个)

10. **🚗 天气路况** - 天气感知驾驶
11. **🚗 车辆维护** - 保养维修服务
12. **🚗 新手司机** - 新手辅助驾驶
13. **🚗 商务出行** - 商务效率优化
14. **🚗 家庭出游** - 家庭友好路线
15. **🚗 夜间驾驶** - 夜间安全驾驶

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置环境

```bash
# 复制环境变量模板
cp .env.example .env

# 编辑 .env 文件，填入你的配置
# - BAIDU_MAP_AK
# - TAVILY_API_KEY
# - AWS 凭证等
```

### 3. 部署 Agent

```bash
# 部署到 AgentCore
agentcore deploy

# 记录返回的 Runtime ARN
# 更新 clients/boto3_client.py 中的 agent_runtime_arn
```

### 4. 运行测试

```bash
# 方法1: 交互式选择场景
python clients/boto3_client.py

# 方法2: 直接运行座舱模式（推荐）
python clients/boto3_client.py
# 然后选择 "座舱模式" 选项

# 方法3: 自定义问题
python clients/boto3_client.py "导航到最近的加油站"
```

## 💡 使用示例

### 示例 1: 智能导航（P0）

```
用户: 导航到国贸CBD
Agent: 正在为您规划路线...

用户: 前方路况怎么样？
Agent: 前方3公里处有轻微拥堵...

用户: 有没有更快的路线？
Agent: 已为您找到更快路线，预计节省8分钟...
```

### 示例 2: 沿途服务（P1）

```
用户: 我在去机场的路上，还有30分钟
Agent: 好的，已记录您的时间约束

用户: 路上想吃点东西，推荐顺路的餐厅
Agent: 为您找到3家顺路餐厅...

用户: 那家店有停车位吗？
Agent: 该餐厅有停车场，免费停车2小时...

用户: 如果在那里吃饭，会不会耽误航班？
Agent: 预计用餐20分钟，仍可准时到达机场
```

### 示例 3: 停车场景（P1）

```
用户: 我要去三里屯太古里购物
Agent: 正在为您导航...

用户: 那里有停车场吗？
Agent: 太古里有3个停车场...

用户: 停车费怎么收？
Agent: 10元/小时，购物满500元可免费停车3小时

用户: 导航到停车场入口
Agent: 已切换到停车场入口导航
```

## 🎮 交互式菜单

运行 `python clients/boto3_client.py` 后会看到：

```
🚗 智能座舱对话场景 (共16个场景):
================================================================================

基础场景:
--------------------------------------------------------------------------------
 1. 基础场景     - 6 个问题

🚗 智能座舱专属场景 (按优先级排序):
--------------------------------------------------------------------------------
 2. 🚗智能导航   - 7 个问题 [P0]
 3. 🚗沿途服务   - 7 个问题 [P1]
 4. 🚗停车场景   - 7 个问题 [P1]
 5. 🚗自驾游     - 7 个问题 [P2]
 6. 🚗接送人     - 7 个问题 [P2]
 7. 🚗充电加油   - 7 个问题 [P1]
 8. 🚗实时路况   - 7 个问题 [P0]
 9. 🚗语音控制   - 7 个问题 [P2]
10. 🚗多目的地   - 7 个问题 [P2]
11. 🚗天气路况   - 7 个问题 [P3]
12. 🚗车辆维护   - 7 个问题 [P3]
13. 🚗新手司机   - 7 个问题 [P3]
14. 🚗商务出行   - 7 个问题 [P3]
15. 🚗家庭出游   - 7 个问题 [P3]
16. 🚗夜间驾驶   - 7 个问题 [P3]
================================================================================
17. 全部场景     - 运行所有场景 (基础 + 座舱)
18. 座舱模式     - 按优先级运行座舱场景 (推荐)
================================================================================

请选择场景编号 (直接回车运行基础场景):
```

## 📊 性能指标

### 响应时间（车载要求）

| 场景类型 | 首次响应 | 完整响应 | 优先级 |
| -------- | -------- | -------- | ------ |
| 导航启动 | < 1s     | < 2s     | P0     |
| 路况查询 | < 1s     | < 3s     | P0     |
| POI 搜索 | < 1.5s   | < 3s     | P1     |
| 路线规划 | < 2s     | < 5s     | P1     |
| 信息查询 | < 1s     | < 4s     | P2     |

### 准确率要求

| 功能     | 准确率 | 说明     |
| -------- | ------ | -------- |
| 导航地址 | > 95%  | 核心功能 |
| 路况信息 | > 90%  | 实时数据 |
| POI 搜索 | > 90%  | 基础功能 |
| 指代理解 | > 85%  | 上下文   |

## 🔧 配置说明

### 更新 Runtime ARN

编辑 `clients/boto3_client.py`:

```python
# 替换为你的 AgentCore Runtime ARN
agent_runtime_arn = 'arn:aws:bedrock-agentcore:us-west-2:YOUR_ACCOUNT:runtime/YOUR_RUNTIME'
```

### Session ID 管理

```python
# 每次运行自动生成新的 session ID
session_id = f"session_{uuid.uuid4().hex}"

# 或使用固定 session ID 保持对话上下文
session_id = "my_driving_session_20250101"
```

## 📚 文档

- [智能座舱场景详细指南](docs/IN_CAR_SCENARIOS.md) - 每个场景的详细说明
- [对话场景使用指南](docs/CONVERSATION_SCENARIOS.md) - 通用场景文档
- [Memory 功能指南](docs/MEMORY_GUIDE.md) - 上下文记忆功能

## 🧪 测试

### 运行测试脚本

```bash
# 运行测试菜单
python tests/test_conversation_scenarios.py

# 测试指定场景
python tests/test_conversation_scenarios.py "🚗智能导航"
```

### 测试选项

```
对话场景测试工具
================================================================================
1. 测试上下文理解能力
2. 测试个性化推荐能力
3. 测试单个场景
4. 运行所有测试
================================================================================
```

## 🎯 车载使用建议

### 1. 优先级使用

- **P0 场景** - 每次必测，核心功能
- **P1 场景** - 高频测试，刚需功能
- **P2 场景** - 定期测试，常用功能
- **P3 场景** - 选择性测试，辅助功能

### 2. 安全第一

- ✅ 优先使用语音交互
- ✅ 简化对话流程
- ✅ 快速响应反馈
- ⚠️ 避免驾驶中手动操作

### 3. 上下文理解

```python
# 支持的指代词
"那里" "这个" "刚才" "这条路" "那家店"

# 示例对话
用户: "导航到三里屯"
用户: "那里有停车场吗？"  # 理解"那里"=三里屯
用户: "停车费多少？"      # 继续理解上下文
```

## 🔍 故障排查

### 问题 1: 无法理解上下文

**解决方案**:

- 确保使用相同的 session_id
- 检查 Memory 配置
- 查看 CloudWatch Logs

### 问题 2: 响应速度慢

**解决方案**:

- 减少对话历史轮数
- 优化网络连接
- 使用更快的模型

### 问题 3: 流式输出中断

**解决方案**:

- 检查网络稳定性
- 增加超时时间
- 查看错误日志

## 📞 支持

- 查看文档: [docs/](docs/)
- 提交 Issue: GitHub Issues
- 技术支持: [support@example.com]

## 📄 许可证

MIT License

---

**🚗 专为智能座舱优化，让驾驶更智能、更安全！**
